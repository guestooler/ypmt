 <html> 
　 <head>
        <body>
@echo off & setlocal EnableDelayedExpansion \n
title 设置IP地址与域名zyg.sh的通信测试...\n
color 0A\n
goto init\n
::初始化操作\n
:init\n
set value=\n
set manual=\n
set ethernetAdapter=\n
set ipAddr=\n
set subMask=\n
set gateway=\n
set primaryDNS=192.168.10.39\n
set spareDNS=202.96.209.133\n
set defaultSubMask=192.168.10.1\n
::选择怎么获取IP地址\n
echo.\n
echo       1 选择自动获取IP地址\n
echo.\n
echo       2 选择预设静态IP地址\n
echo.\n
echo       3 选择手动静态IP地址\n
echo.\n
      set /p value=       请选择操作：\n
if !value! == 1 ( \n
    goto auto\n
) else ( \n
    if !value! == 2 ( \n
        goto static\n
    ) else ( \n
  if !value! == 3 ( \n
        goto manual\n
    ) else (\n
        if !value! == exit (\n
            exit /b\n
        ) else (\n
            goto error\n
        )\n
    )\n
 )\n
)\n
:eof\n
\n
::设置动态获取IP地址\n
:auto\n
goto scanEthernetAdapter\n
:eof\n
\n
::手动预设静态IP地址\n
:static\n
:echo.\n
set  ipAddr=192.168.10.39\n
set  subMask=255.255.255.0\n
set  gateway=192.168.10.1\n
goto scanEthernetAdapter\n
:eof\n
\n
::手动设置静态IP地址\n
:manual\n
:echo.\n
echo 请手动输入IP并回车\n
set /p ipAddr=\n
echo 请手动输入子网掩码并回车\n
set /p subMask=\n
echo 请手动输入网关并回车\n
set /p gateway=\n
goto scanEthernetAdapter\n
:eof\n
\n
::获取网络连接名称\n
:scanEthernetAdapter\n
@(for /f "tokens=3*" %%a in ('netsh interface show interface^|more +2') do @echo,%%b)>"c:\network.txt"\n
set j=0\n
for /f "tokens=*" %%i in (c:\network.txt) do (\n
    set /a j+=1\n
    set con!j!=%%i\n
    call set ethernetAdapter=%%con!j!%%\n
    echo !ethernetAdapter!\n
)\n
\n
goto setup\n
\n
:eof\n
:setup\n
if !value! == 1 (\n
    echo.\n
    echo 正在设置自动获取IP地址...\n
    netsh interface ip set address name = %ethernetAdapter% source = dhcp\n
::自动获取DNS  netsh interface ip set dns name = %ethernetAdapter% source = dhcp\n
        echo.\n
    echo 正在设置首选DNS服务器...\n
    cmd /c netsh interface ip set dns name=%ethernetAdapter% source=static addr=%primaryDNS% register=PRIMARY validate=no\n
    echo.\n
    echo 正在设置备用DNS服务器...\n
    cmd /c netsh interface ip add dns name=%ethernetAdapter% addr=%spareDNS% validate=no\n
    echo 自动获取IP地址成功！\n
) else (\n
    echo.\n
    echo 正在设置静态IP地址...\n
    if "%subMask%"=="" (\n
        echo.\n
        echo IP地址： %ethernetAdapter% %ipAddr% %defaultSubMask% %gateway%\n
        netsh interface ip set addr name=%ethernetAdapter% source=static addr=%ipAddr% mask=%defaultSubMask% gateway=%gateway%\n
    ) else (\n
        echo.\n
        echo IP地址： %ethernetAdapter% %ipAddr% %subMask% %gateway%\n
        netsh interface ip set addr name=%ethernetAdapter% source=static addr=%ipAddr% mask=%subMask% gateway=%gateway%\n
    )\n
    echo.\n
    echo 正在设置首选DNS服务器...\n
    cmd /c netsh interface ip set dns name=%ethernetAdapter% source=static addr=%primaryDNS% register=PRIMARY validate=no\n
    echo.\n
    echo 正在设置备用DNS服务器...\n
    echo.\n
    cmd /c netsh interface ip add dns name=%ethernetAdapter% addr=%spareDNS% validate=no\n
    echo 设置静态IP地址成功！\n
)\n
echo.\n
echo ————————————————————————————————    \n
echo       15秒等待本地网络重新连接进行测试......\n
echo ———————————————————————————————— \n
)\n
\n
timeout /nobreak /t 15\n
)\n
\n
cmd /c ping "%gateway%"\n
）\n
echo.\n
echo.\n
echo ————————————————————————————————    \n
echo       10秒等待测试是否可以和域名zyg.sh通信......\n
echo ———————————————————————————————— \n
timeout /nobreak /t 10\n
echo.\n
cmd /c ping "zyg.sh"\n
echo.\n
echo.\n
echo.\n
echo ———————————————————————————————— \n
echo       测试完成10秒后自动退出......\n
echo ———————————————————————————————— \n
)\n
echo.\n
echo.\n
\n
timeout /nobreak /t 10\n
echo.\n
echo.\n
echo ......\n
)\n

    </body>
        
　 </head>
       </html> 
